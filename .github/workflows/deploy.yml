name: ðŸš€ Deploy Frontend

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ”“ Configurar acceso SSH
        uses: webfactory/ssh-agent@v0.8.0
        with:
          ssh-private-key: ${{ secrets.SOFTWARESSH }}

      - name: ðŸ“¡ Conectarse al servidor y desplegar
        run: |
          ssh -o ServerAliveInterval=60 -o ServerAliveCountMax=10 -o StrictHostKeyChecking=no root@24.199.104.57 << 'ENDSSH'
            cd /root/projects/frontends/Generador-Frontends-Movil &&
            git pull origin main &&
            npm install &&
            echo "ðŸš€ Ejecutando build en segundo plano..."
            nohup sh -c "
              npm run build &&
              rm -rf /var/www/generador-frontends/* &&
              cp -r dist/* /var/www/generador-frontends/ &&
              chown -R www-data:www-data /var/www/generador-frontends &&
              systemctl reload nginx
            " > /root/build_frontend.log 2>&1 &
          ENDSSH
